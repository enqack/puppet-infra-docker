---
containers:

  puppetdb:
    image: iverberk/puppetdb:packer
    run:
      volumes-from: ["puppetdb_datastore"]
      volume: ["./:/host"]
      publish: ["8080:8080"]
      expose: ["8081"]
      cmd: ["/usr/bin/supervisord", "-c", "/etc/supervisord.conf"]
      hostname: puppetdb.localdomain
      detach: true

  puppetdb_datastore:
    image: iverberk/puppetdb:packer
    run:
      volume: ["/var/lib/pgsql/data"]
      cmd: ["true"]
      detach: true

  foreman:
    image: iverberk/foreman:packer
    run:
      volumes-from: ["foreman_datastore"]
      volume: ["./:/host"]
      publish: ["443:443"]
      cmd: ["/usr/bin/supervisord", "-c", "/etc/supervisord.conf"]
      hostname: foreman.localdomain
      detach: true
      link: ["puppetmaster:puppetmaster.localdomain"]

  foreman_datastore:
    image: iverberk/foreman:packer
    run:
      volume: ["/var/lib/pgsql/data"]
      cmd: ["true"]
      detach: true

  puppetmaster:
    image: iverberk/puppetmaster:packer
    run:
      volume: ["./environments:/etc/puppet/environments", "./hiera:/etc/puppet/hiera"]
      volumes-from: ["puppetmaster_datastore"]
      cmd: ["/usr/bin/supervisord", "-c", "/etc/supervisord.conf"]
      detach: true
      hostname: puppetmaster.localdomain
      expose: ["8443"]
      publish: ["8140:8140"]
      link: ["puppetdb:puppetdb.localdomain"]

  puppetmaster_datastore:
    image: iverberk/puppetmaster:packer
    run:
      volume: ["/var/lib/puppet/ssl"]
      cmd: ["true"]
      detach: true